---
title: "Leveraging the Boruta Algorithm for Variable Selection in Structural Equation Models"
subtitle: "DGPs Congress Symposia: Methods and Applications of Modeling Technique; HÃ¶rsaal 30"  
author: 
  - "Andreas M. Brandmaier"
  - "Pryanka Paul"
  - "Timothy R. Brick"
date: '`r Sys.Date()`'
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    nature:
      slideNumberFormat: "%current%"
      highlightStyle: github
      highlightLines: true
      ratio: 16:9
      countIncrementalSlides: true
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  fig.width=9, fig.height=3.5, fig.retina=3,
  out.width = "100%",
  cache = FALSE,
  echo = TRUE,
  message = FALSE, 
  warning = FALSE,
  hiline = TRUE
)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_duo_accent(
  primary_color = "#1381B0",
  secondary_color = "#FF961C",
  inverse_header_color = "#FFFFFF"
)

library(semtree)
library(ggplot2)
library(tidyverse)
```

## Title

<center><img src="img-downloaded/Boruta.jpg" height="400px" /></center>

A spirit or devil from slavic mythology, <small>image from Wikipedia/Public Domain</small>

## Idea

- Create random copies of all predictors (_shadow features_)
- Run a predictive model with original and shadow features
- Compute a measure of variable importance
- Only keep original predictors more important than shadow features

## The End

class: center middle inverse

## Algorithm

Preparation:
- Choose an $alpha$-level for the statistical tests 
- Choose a multiple-testing correction (from `stats::p.adjust.methods`): `r print(stats::p.adjust.methods)`

## Algorithm

- Create a copy of the original data set
- Create shadow features by permutation of all non-rejected features (remove association of shadow features with outcome(s) )
- At each iteration, compute z-score of all original and shadow features
- A feature is considered relevant if it performs better than the best shadow feature
- Run a statistical test for each original predictor 
- If significant, tag predictor as 'relevant'

## Setting Alpha

-  $\alpha=0.05$ -> features need to outperform 95% of shadow features
- $\alpha=0$ -> features need to outperform the best shadow features ($\max$-operator)

## Decision Trees



## SEM

## SEM Trees

## A minimal simulation

class: inverse center middle

## Setup

##
```{r}
tree_ex1 <- readRDS("results/ex1/tree.rds")
plot(prune(tree_ex1,2))
```
## 

```{r}
#vim<-readRDS("results/ex1/vi.rds")
#plot(vim)
```

```{mermaid}
flowchart LR
  A[Hard edge] --> B(Round edge)
  B --> C{Decision}
  C --> D[Result one]
  C --> E[Result two]
```
##

```{r}
readRDS("results/ex1/boruta_result.rds")
```

## Let's fuse all three things!

![](img/madscientist.png)

## A minimal application

```{r}
diabetes <- read.csv("data-downloaded/diabetes.csv")
knitr::kable(tibble::as.tibble(diabetes))
```

## Parallelization

- Iterations of BORUTA must remain sequential (because of possible rejections)

- Parallelization of forests and variable importance calculation is costly and can be parallelized using `future`

```{r}
plan(multisession, workers = 4)

boruta_result<-boruta(fitted_model, diabetes)
```

# Thank You

.left[

1. https://github.com/brandmaier/boruta_presentation_dgps
2. https://github.com/brandmaier/semtree
3. Contact: andreas.brandmaier@medicalschool-berlin.de or @brandmaier on X or @brandmaier.bsky.social on Bluesky

]



```{r, echo=FALSE}
link <- "https://github.com/brandmaier/boruta_presentation_dgps"
```

```{r, echo=FALSE, out.width = "30%", out.extra='style="float:center"'}
generate_svg(qr_code(link), here::here("img/", "qr_slides.svg"), foreground = secondary_color, background = primary_color, show = FALSE)
knitr::include_graphics("images/qr_slides.svg")
```
